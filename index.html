<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Menu Brands - Cardápio Digital</title>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  
  <style>
    :root { --vermelho: #e30613; --vermelho-hover: #c4000f; --branco: #fff; }
    body { margin: 0; font-family: 'Segoe UI', Arial, sans-serif; background: #fff; color: #333; overflow-x: hidden; }

    /* TOPBAR +20% MAIOR */
    .topbar {
      background: var(--vermelho);
      padding: 22px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 6px 20px rgba(227,6,19,0.35);
      position: relative;
      z-index: 100;
      min-height: 100px;
    }
    .btn-lojas {
      background: none; border: none; color: white; font-size: 1.62em;
      cursor: pointer; padding: 12px 18px; border-radius: 12px; transition: 0.2s; font-weight: bold;
    }
    .btn-lojas:hover { background: rgba(255,255,255,0.25); }

    .logo-container {
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      max-width: 240px;
    }
    .logo-container img {
      width: 100%;
      height: auto;
      max-height: 144px;
      object-fit: contain;
    }

    /* SIDEBAR E OVERLAY */
    .sidebar {
      position: fixed; top: 0; left: -320px; width: 320px; height: 100%; background: #111;
      transition: left 0.35s ease; z-index: 999; padding-top: 120px; box-shadow: 5px 0 20px rgba(0,0,0,0.5);
    }
    .sidebar.open { left: 0; }
    .sidebar ul { list-style: none; padding: 0; margin: 0; }
    .sidebar li {
      padding: 22px 25px; color: white; cursor: pointer; transition: 0.3s; font-size: 1.25em;
      border-bottom: 1px solid #333;
    }
    .sidebar li:hover, .sidebar li.active { background: var(--vermelho); font-weight: bold; }
    .overlay { 
      display: none; 
      position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
      background: rgba(0,0,0,0.5); z-index: 998; 
    }

    .container { max-width: 1160px; margin: 50px auto; padding: 0 20px; }
    .filtros {
      background: white; padding: 24px; border-radius: 16px; box-shadow: 0 6px 20px rgba(0,0,0,0.08);
      margin-bottom: 30px; text-align: center; border: 3px solid var(--vermelho);
    }
    .filtros label { font-weight: 700; color: var(--vermelho); font-size: 1.2em; margin-right: 12px; }
    select, input { padding: 13px 16px; font-size: 1.05em; border: 2px solid #ddd; border-radius: 12px; }
    select { width: 320px; }
    input { width: 420px; max-width: 100%; border-color: var(--vermelho); margin-left: 15px; }

    table { width: 100%; border-collapse: collapse; background: white; border-radius: 16px; overflow: hidden; box-shadow: 0 8px 25px rgba(227,6,19,0.12); border: 2px solid var(--vermelho); }
    th { background: var(--vermelho); color: white; padding: 18px 16px; font-weight: 600; font-size: 1.1em; }
    td { padding: 18px 16px; cursor: pointer; transition: 0.2s; }
    tr:hover { background: #fff5f5; }
    tr.selected { background: #ffebee !important; }
    .preco { font-weight: bold; color: var(--vermelho); text-align: right; font-size: 1.2em; }
    .categoria-tag {
      background: var(--vermelho); color: white; padding: 7px 16px; border-radius: 30px;
      font-size: 0.85em; font-weight: bold; max-width: 180px; overflow: hidden;
      text-overflow: ellipsis; white-space: nowrap; display: inline-block;
    }

    /* CARRINHO FLUTUANTE */
    .carrinho-flutuante {
      position: fixed; bottom: 20px; right: 20px; width: 400px; background: white;
      border-radius: 20px; box-shadow: 0 15px 35px rgba(0,0,0,0.3); border: 4px solid var(--vermelho);
      z-index: 1000; transition: all 0.3s ease; display: none; overflow: hidden;
    }
    .carrinho-header {
      background: var(--vermelho); color: white; padding: 18px 20px; font-size: 1.5em;
      text-align: center; font-weight: bold; position: relative; min-height: 32px;
      display: flex; align-items: center; justify-content: center;
    }
    .carrinho-header span { flex: 1; text-align: center; }
    .btn-minimizar, .btn-fechar {
      background: none; border: none; color: white; font-size: 1.8em; cursor: pointer; font-weight: bold;
      width: 44px; height: 44px; display: flex; align-items: center; justify-content: center;
    }
    .btn-minimizar { order: -1; }
    .btn-fechar { order: 1; }
    .carrinho-body { max-height: 50vh; overflow-y: auto; padding: 18px; }
    .item-carrinho {
      background: #fff0f0; border-radius: 14px; padding: 14px; margin: 12px 0;
      display: flex; justify-content: space-between; align-items: center; font-size: 1em;
    }
    .quantidade {
      display: flex; align-items: center; gap: 12px; background: white; padding: 8px 14px; border-radius: 30px;
    }
    .quantidade button {
      width: 32px; height: 32px; border: none; background: var(--vermelho); color: white;
      border-radius: 50%; cursor: pointer; font-weight: bold; font-size: 1.1em;
    }
    .carrinho-total {
      background: #fff5f5; padding: 20px; text-align: center; font-size: 1.7em;
      font-weight: bold; color: var(--vermelho); border-top: 4px solid var(--vermelho);
    }
    .minimizado { width: 300px !important; height: 100px !important; }
    .minimizado .carrinho-body { display: none !important; }
    .minimizado .carrinho-total { font-size: 1.6em !important; padding: 24px 12px !important; }
    .minimizado .carrinho-header { padding: 14px 18px; font-size: 1.4em; }

    @media (max-width: 768px) {
      .carrinho-flutuante, .minimizado { width: 92% !important; right: 4%; left: 4%; }
      .topbar { padding: 16px; }
      .logo-container { max-width: 180px; }
    }
  </style>
</head>
<body>

  <div class="topbar">
    <button class="btn-lojas" onclick="toggleSidebar()">Lojas</button>
    <div class="logo-container">
      <img src="Menu.png" alt="Menu Brands">
    </div>
    <div style="width: 70px;"></div>
  </div>

  <div class="overlay" onclick="toggleSidebar()"></div>
  <div class="sidebar" id="sidebar">
    <ul>
      <li onclick="carregarLoja('MenuFiltrado.csv', 'Menu Brands')" class="active" id="loja-menu">Menu Brands</li>
      <li onclick="carregarLoja('PokeFiltrado.csv', 'Poké Nordestino')" id="loja-poke">Poké Nordestino</li>
    </ul>
  </div>

  <div class="container">
    <div class="filtros">
      <label for="categoria">Filtrar por categoria:</label>
      <select id="categoria"><option value="">Tudo</option></select>
      <input type="text" id="busca" placeholder=" Pesquisar produto ou descrição...">
    </div>
    <div id="resultado"></div>
  </div>

  <div id="carrinho" class="carrinho-flutuante">
    <div class="carrinho-header">
      <button class="btn-minimizar" onclick="minimizarCarrinho()">−</button>
      <span>Seu Pedido</span>
      <button class="btn-fechar" onclick="fecharCarrinho()">×</button>
    </div>
    <div class="carrinho-body" id="listaItens">Clique nos itens para adicionar</div>
    <div class="carrinho-total">Total: R$ 0,00</div>
  </div>

  <script>
    let todosOsItens = [];
    let carrinho = [];

    function limparCategoria(txt) {
      if (!txt || txt.trim() === "") return "Outros";
      return txt.toString().replace(/[\r\n\t\v\f]+/g, " ").replace(/[^\w\s\-\(\)\+\&à-úÀ-Ú]/g, "").replace(/\s+/g, " ").replace(/:/g, "").trim().substring(0, 80);
    }

    function carregarLoja(arquivo, nomeLoja, elementoClicado = null) {
      document.querySelectorAll(".sidebar li").forEach(li => li.classList.remove("active"));
      if (elementoClicado) elementoClicado.classList.add("active");
      else document.getElementById("loja-menu").classList.add("active");

      Papa.parse(arquivo, {
        download: true, header: true, skipEmptyLines: true,
        complete: function(results) {
          todosOsItens = results.data
            .filter(i => i["NOME CARDAPIO"] && i["NOME CARDAPIO"].trim())
            .map(i => ({ ...i, CATEGORIA: limparCategoria(i.CATEGORIA) }));

          const categorias = [...new Set(todosOsItens.map(i => i.CATEGORIA))].sort();
          const select = document.getElementById("categoria");
          select.innerHTML = '<option value="">Tudo</option>';
          categorias.forEach(c => {
            const opt = document.createElement("option"); opt.value = c; opt.textContent = c; select.appendChild(opt);
          });
          mostrarItens(todosOsItens);
        },
        error: function() {
          document.getElementById("resultado").innerHTML = "<p style='color:red;text-align:center;'>Erro ao carregar o cardápio.</p>";
        }
      });
    }

    function toggleSidebar() {
      const sidebar = document.getElementById("sidebar");
      sidebar.classList.toggle("open");
      document.querySelector(".overlay").style.display = sidebar.classList.contains("open") ? "block" : "none";
    }

    // INICIA COM MENU BRANDS E SIDEBAR FECHADA - 100% GARANTIDO
    window.addEventListener("DOMContentLoaded", () => {
      carregarLoja("MenuFiltrado.csv", "Menu Brands"); // carrega Menu Brands
      document.getElementById("sidebar").classList.remove("open"); // garante sidebar fechada
      document.querySelector(".overlay").style.display = "none";   // overlay escondido
    });

    function mostrarItens(itensFiltrados) {
      const container = document.getElementById("resultado");
      if (itensFiltrados.length === 0) {
        container.innerHTML = '<p style="text-align:center; color:#888; padding:50px;">Nenhum produto encontrado.</p>';
        return;
      }
      let html = `<table><thead><tr>
        <th style="width:180px;">Categoria</th>
        <th>Nome no Cardápio</th>
        <th>Nome PDV</th>
        <th>Cód. PDV</th>
        <th style="width:110px;">Preço</th>
        <th>Descrição</th>
      </tr></thead><tbody>`;
      itensFiltrados.forEach(item => {
        const preco = parseFloat(item["PREÇO VENDA CHEIO"]) || 0;
        const itemNoCarrinho = carrinho.find(x => x.codigo === item["CÓD PDV"]);
        const qtd = itemNoCarrinho ? itemNoCarrinho.qtd : 0;
        const itemJSON = JSON.stringify(item).replace(/'/g, "&apos;");
        html += `<tr onclick='adicionarItem(${itemJSON})' style="cursor:pointer;${qtd>0?'background:#ffebee;':''}">
          <td><span class="categoria-tag">${item.CATEGORIA}</span></td>
          <td><strong>${item["NOME CARDAPIO"]}</strong>${qtd>0?` <small style="color:var(--vermelho)">(${qtd}x)</small>`:''}</td>
          <td>${item["NOME PDV"]}</td>
          <td>${item["CÓD PDV"]}</td>
          <td class="preco">R$ ${preco.toFixed(2).replace(".",",")}</td>
          <td>${item["DESCRICAO ITEM CARDAPIO"]}</td>
        </tr>`;
      });
      container.innerHTML = html + `</tbody></table>`;
    }

    function adicionarItem(item) {
      const existente = carrinho.find(x => x.codigo === item["CÓD PDV"]);
      if (existente) existente.qtd += 1;
      else carrinho.push({ nome: item["NOME PDV"], codigo: item["CÓD PDV"], preco: parseFloat(item["PREÇO VENDA CHEIO"]) || 0, qtd: 1 });
      document.getElementById("carrinho").style.display = "block";
      atualizarCarrinho();
      mostrarItens(getItensFiltrados());
    }

    function mudarQuantidade(codigo, delta) {
      const item = carrinho.find(x => x.codigo === codigo);
      if (item) {
        item.qtd += delta;
        if (item.qtd <= 0) carrinho = carrinho.filter(x => x.codigo !== codigo);
        atualizarCarrinho();
        mostrarItens(getItensFiltrados());
      }
    }

    function atualizarCarrinho() {
      const lista = document.getElementById("listaItens");
      const totalEl = document.querySelector(".carrinho-total");
      if (carrinho.length === 0) {
        document.getElementById("carrinho").style.display = "none";
        return;
      }
      let html = ""; let total = 0;
      carrinho.forEach(item => {
        const subtotal = item.preco * item.qtd; total += subtotal;
        html += `<div class="item-carrinho">
          <div><strong>${item.nome}</strong><br>Cód: ${item.codigo} — R$ ${item.preco.toFixed(2).replace(".",",")} cada</div>
          <div class="quantidade">
            <button onclick="mudarQuantidade('${item.codigo}', -1)">−</button>
            <span style="min-width:36px;text-align:center;font-weight:bold;">${item.qtd}</span>
            <button onclick="mudarQuantidade('${item.codigo}', 1)">+</button>
          </div>
        </div>`;
      });
      lista.innerHTML = html || "Nenhum item";
      totalEl.textContent = `Total: R$ ${total.toFixed(2).replace(".",",")}`;
    }

    function minimizarCarrinho() {
      document.getElementById("carrinho").classList.toggle("minimizado");
    }

    function fecharCarrinho() {
      carrinho = [];
      document.getElementById("carrinho").style.display = "none";
      mostrarItens(getItensFiltrados());
    }

    function getItensFiltrados() {
      let lista = todosOsItens;
      const cat = document.getElementById("categoria").value;
      const termo = document.getElementById("busca").value.toLowerCase().trim();
      if (cat) lista = lista.filter(i => i.CATEGORIA === cat);
      if (termo) lista = lista.filter(i =>
        (i["NOME CARDAPIO"]||"").toLowerCase().includes(termo) ||
        (i["NOME PDV"]||"").toLowerCase().includes(termo) ||
        (i["DESCRICAO ITEM CARDAPIO"]||"").toLowerCase().includes(termo)
      );
      return lista;
    }

    document.getElementById("categoria").addEventListener("change", () => mostrarItens(getItensFiltrados()));
    document.getElementById("busca").addEventListener("input", () => mostrarItens(getItensFiltrados()));
  </script>
</body>
</html>
